# FilmLab 项目现状与待办汇总（2026-02-19）

本文件作为 `docs/` 的统一状态文档，用于替代早期拆分的中间产物文档。

## 1. 产品主线与当前范围

- 主线流程：`导入素材 -> 选择风格 -> 导出`（单工作台）。
- 目标人群：摄影后期初学者，优先“默认可用 + 低学习成本”。
- 当前仍是本地优先方案（IndexedDB 持久化 + 前端渲染导出）。

## 2. 已实现能力（按模块）

### 2.1 信息架构与页面

- 已实现 Workspace 三步流程（素材 / 风格 / 导出）与步骤切换。
- 已保留单张精修入口（`/editor`）用于进阶调整。
- 桌面端已具备左侧素材区 + 中央主内容的工作台结构。
- 已补齐工作台上下文恢复（`step` / 选中素材 / 当前风格强度）。

### 2.2 素材导入与管理

- 支持 JPG/PNG/WebP 导入，多选与拖拽导入可用。
- 已实现缩略图、EXIF 元数据解析与资产列表筛选。
- 资产、项目与编辑状态核心数据已接入 IndexedDB。

### 2.3 风格与批量应用

- 支持预设列表、强度滑杆、按选中集/按分组批量应用。
- 已支持 AI 推荐（前端调用 `/api/recommend-film`，服务端调用模型）。
- 已支持自定义预设保存与复用（localStorage）。

### 2.4 编辑与渲染管线

- 编辑器支持基础参数、曲线/HSL、胶片模块参数覆盖等调节。
- 已实现 `FilmProfile` 模块化渲染链路（color/tone/scan/grain/defects）。
- 渲染策略为 WebGL2 优先、CPU pipeline 回退。
- **（新）PixiJS 多 Pass 渲染引擎已作为默认 GPU 路径**：
  - `MasterAdjustmentFilter`：OKLab HSL + LMS 白平衡 + 科学色彩调整。
  - `FilmSimulationFilter`：特性曲线 + 3D LUT（HaldCLUT）+ Grain + Vignette。
  - `HalationBloomFilter`：光晕与泛光效果。
  - `LUTLoader` / `LUTCache`：HaldCLUT 解析 → WebGL 3D Texture + LRU 缓存。
  - `PixiRenderer` 封装 + `uniformResolvers` 兼容层（v1 数据 → 新 Uniform）。
  - 动态加载 PixiJS 不影响默认包体积；可通过 `window.__FILMLAB_USE_LEGACY = true` 回退到旧管线。

### 2.5 导出

- 支持格式、质量、长边尺寸配置。
- 支持批量导出任务状态展示（等待/处理中/完成/失败）。
- 已补齐导出完成反馈（Toast +「查看结果 / 返回素材库」动作）。

## 3. 部分实现 / 仍需补齐

- 风格流程已具备推荐与卡片，但卡片“前后对比图”尚未形成统一能力。
- 文案存在历史乱码，尚未完成全量 UTF-8 清理。

## 4. 待办清单（按优先级）

### P0（优先）

1. ✅ 工作台恢复能力补齐（已完成）：
   - 已持久化上次 `step`、选中资产、选中风格。
   - 已支持启动后恢复到上次工作上下文。
2. ✅ 导出反馈补齐（已完成）：
   - 已增加导出完成/失败 Toast。
   - 已提供“查看结果/返回素材库”明确动作。
3. 文案与编码治理：
   - 全项目中文文案统一 UTF-8。
   - 清理乱码与占位文案。

### P1（体验增强）

1. 风格卡片加入前后对比缩略能力。
2. ✅ 导出步骤补齐小图预览区（已完成）：
   - 已新增导出预览网格（缩略图 + 状态角标）。
   - 状态与导出任务一致（未开始/等待/处理中/完成/失败）。
3. ✅ 梳理“进阶入口与返回主线”的单一出口体验（已完成）：
   - `/editor` 新增 `returnStep`，统一回流到 `/?step=<returnStep>`。
   - 编辑器内移除直跳导出的第二出口，保留顶部单一返回入口。

### P2（性能与架构）

1. 导出队列改造为 Worker/OffscreenCanvas（避免主线程阻塞）。
2. 大图渲染与移动端内存策略优化（分辨率降级/分段处理）。
3. ✅ PixiJS 渲染引擎已正式启用为默认 GPU 路径（feature flag 已移除）。
4. 首批 HaldCLUT 胶片 LUT 资源制作与集成。

## 5. 非目标（当前阶段不做）

- 云端协作与同步。
- RAW 全流程支持。
- 完整云端渲染服务化。

## 6. 文档维护约定

- 该文件是产品进度与待办的唯一汇总入口。
- 胶片渲染底层细节继续维护在 `docs/film_pipeline.md`。
- 编辑器重构技术方案详见 `docs/editor.md`。
- 版本迭代后仅更新本文件，不再新增重复的计划拆分文档。
